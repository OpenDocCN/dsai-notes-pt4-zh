<!--yml

category: 未分类

日期：2025-01-11 11:52:46

-->

# MedChain：通过互动式顺序基准测试架起LLM代理与临床实践之间的桥梁

> 来源：[https://arxiv.org/html/2412.01605/](https://arxiv.org/html/2412.01605/)

Jie Liu¹, Wenxuan Wang^(2∗), Zizhan Ma², Guolin Huang³, SU Yihang²,

Kao-Jung Chang^(4,5), Wenting Chen¹, Haoliang Li¹, Linlin Shen³, Michael Lyu²

¹香港城市大学 ²香港中文大学

³深圳大学 ⁴国立阳明交通大学

⁵台北荣民总医院

项目：[https://github.com/ljwztc/MedChain](https://github.com/ljwztc/MedChain) J. Liu ($\spadesuit$$\clubsuit$$\diamondsuit$)，W. Wang ($\heartsuit$$\clubsuit$) 作出同等贡献。$\spadesuit$: 概念化；$\heartsuit$: 实现；$\clubsuit$: 编写；$\diamondsuit$: 可视化。

###### 摘要

临床决策（CDM）是一个复杂且动态的过程，对于医疗服务至关重要，但它仍然是人工智能系统面临的重大挑战。虽然基于大规模语言模型（LLM）的代理已在使用执业考试和知识问答任务的通用医学知识上进行过测试，但由于缺乏能够反映实际医疗实践的全面测试数据集，它们在实际场景中的临床决策表现仍然有限。为了弥补这一空白，我们提出了MedChain，这是一个涵盖临床工作流五个关键阶段的12,163个临床病例数据集。MedChain通过三个反映现实临床实践的关键特性（个性化、互动性和顺序性）区别于现有基准。进一步地，为了应对现实世界中的临床决策挑战，我们还提出了MedChain-Agent，一个集成了反馈机制和MCase-RAG模块的人工智能系统，可以从先前的病例中学习并调整其应答。MedChain-Agent在动态收集信息和处理顺序临床任务方面表现出卓越的适应性，显著优于现有方法。相关数据集和代码将在本文接受后发布。

MedChain：通过互动式顺序基准测试架起LLM代理与临床实践之间的桥梁

Jie Liu¹^†^†致谢：J. Liu ($\spadesuit$ $\clubsuit$ $\diamondsuit$)，W. Wang ($\heartsuit$ $\clubsuit$) 作出同等贡献。$\spadesuit$: 概念化；$\heartsuit$: 实现；$\clubsuit$: 编写；$\diamondsuit$: 可视化。, Wenxuan Wang^(2∗), Zizhan Ma², Guolin Huang³, SU Yihang², Kao-Jung Chang^(4,5), Wenting Chen¹, Haoliang Li¹, Linlin Shen³, Michael Lyu² ¹香港城市大学 ²香港中文大学 ³深圳大学 ⁴国立阳明交通大学 ⁵台北荣民总医院 项目：[https://github.com/ljwztc/MedChain](https://github.com/ljwztc/MedChain)

## 1 引言

人工智能与医疗保健的交汇点是医学中最复杂的挑战之一：临床决策制定（CDM）。在医疗服务中，CDM不仅需要对多种数据来源进行综合，还需要不断评估变化的临床情境，同时进行基于证据的诊断和治疗判断Sutton 等人（[2020](https://arxiv.org/html/2412.01605v1#bib.bib32)）。尽管对于优化患者护理至关重要，这一复杂过程对医疗专业人员的认知需求也很大，因而成为人工智能辅助的理想候选者Sendak 等人（[2020](https://arxiv.org/html/2412.01605v1#bib.bib28)）。

基于大语言模型（LLM）的代理在OpenAI的最新进展（[2023](https://arxiv.org/html/2412.01605v1#bib.bib22)）；Team 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib35)）；Gu 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib12)）；Shinn 等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib30)）；Guan 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib13)）；[Zhuang 等人](https://arxiv.org/html/2412.01605v1#bib.bib49)已经成为复杂决策任务的有效解决方案，从软件开发Qian 等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib25)）到办公自动化Wang 等人（[2024c](https://arxiv.org/html/2412.01605v1#bib.bib41)）。在医学领域，这些代理在医学执照考试中展现了令人印象深刻的表现Singhal 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib31)）；Pal 等人（[2022](https://arxiv.org/html/2412.01605v1#bib.bib23)）和基于知识的评估Gilson 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib10)）；Eriksen 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib7)）。尽管LLM在这些评估中的得分始终远超及格线Singhal 等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib31)），但必须认识到，这些评估未能全面捕捉现实世界临床决策（CDM）的复杂性，主要体现在三个关键方面。

首先，这些基准很少考虑患者特定的信息，如既往病史和现病史（Pal等人，[2022](https://arxiv.org/html/2412.01605v1#bib.bib23)），而这些信息在真实临床场景中对临床决策有着重要影响。忽视这些信息未能捕捉到通常塑造个性化诊断的细微背景。其次，与真实临床场景中决策相互依赖的情况不同，现有基准将临床任务视为独立的问题（Schmidgall等人，[2024](https://arxiv.org/html/2412.01605v1#bib.bib27)），未能体现诊断过程中至关重要的相互依赖性。实际上，临床决策是一个顺序过程，每个步骤都依赖于前面的步骤，一个阶段的错误可能会深远影响后续决策。第三，大多数基准将所有相关信息一次性呈现，提供静态的、全面的数据集（Tu等人，[2024](https://arxiv.org/html/2412.01605v1#bib.bib37)）。然而，真实的临床工作流需要通过持续与患者的互动进行多轮动态信息收集。

![参见说明](img/0f1aa955da61e8056cc8a11688c87bfb.png)

图1：MedChain中CDM错误传播的演示。从2,362个初始病例开始，该图展示了诊断错误如何在五个临床阶段中级联。诊断错误的案例会将问题信息带入后续阶段，导致准确度的累积下降。在完成治疗阶段后，我们会评估各阶段决策的正确性。与其他最先进方法相比，我们的MedChain-Agent在CDM上取得了最佳表现。

MedChain：为了弥补这些关键空白，我们推出了MedChain，一个旨在评估基于LLM的智能体在真实临床场景中的表现的新基准。具体而言，MedChain包括12,163个多样化的案例，涵盖了19个医学专业和156个子类别，其中包括7,338张医学图像及其对应的报告。每个案例都经历五个关键阶段：专科转诊、病史采集、检查、诊断和治疗。与现有基准不同，MedChain独特地强调了三个关键特征。1）个性化：每个案例都包含了详细的患者特定信息。起初，智能体仅获得患者的主诉和基本信息。2）互动性：信息必须通过与患者的动态咨询积极收集。3）顺序性：每个阶段的决策会影响后续步骤。只有在智能体独立完成所有五个阶段后，整体诊断过程才会被评估。

MedChain-Agent：考虑到该基准所带来的新特性和挑战，现有的智能体框架难以充分解决这些问题。为克服这些局限性，我们提出了MedChain-Agent，这是一个多智能体协作框架，能够使大语言模型（LLM）通过反馈机制和MedCase-RAG动态收集信息并处理顺序临床任务。具体而言，MedChain-Agent促进了三种专业智能体类型之间的协同作用：用于任务特定专业的通用智能体、用于洞察合成的总结智能体和用于迭代优化的反馈智能体。这个多层次、迭代的方法确保决策是经过全面分析和多角度考虑的结果。此外，为了应对临床决策制定（CDM）的多维性，需要整合基于证据的研究和患者特定因素，我们在MedChain-Agent框架中加入了一个新颖的MedCase-RAG模块。与传统的医学RAG方法不同，MedCase-RAG动态扩展其数据库，并采用结构化的数据表示方法，将每个医学案例映射为一个12维特征向量。该系统能够高效地检索相关案例，并帮助模型做出明智的决策。

我们的贡献总结如下：

+   •

    我们首次提出了一个临床决策制定（CDM）基准MedChain，提供了对基于大语言模型（LLLM）智能体诊断能力的全面评估，紧密反映了真实世界的患者护理。

+   •

    我们提出了一个基于CDM特征的多智能体框架。该系统能够高效地检索相关案例，并帮助模型做出明智的决策。

+   •

    通过大量实验，我们展示了MedChain和MedChain-Agent框架在提高临床决策准确性和可靠性方面的有效性。

表 1：基于大语言模型智能体的基准比较。MedChain由12,163个案例组成，涵盖了临床工作流程的五个顺序阶段。它为基于LLM的智能体评估提供了交互环境。

| 基准 | 数量 | 模态 | 个人信息 | 顺序评估 | 交互 |
| --- | --- | --- | --- | --- | --- |
| MedQA [2018](https://arxiv.org/html/2412.01605v1#bib.bib48) | 1,273 | 文本 | ✓ | ✗ | ✗ |
| PubMedQA [2019](https://arxiv.org/html/2412.01605v1#bib.bib16) | 500 | 文本 | ✗ | ✗ | ✗ |
| MedMCQA [2022](https://arxiv.org/html/2412.01605v1#bib.bib23) | 193,155 | 文本 | ✓ | ✗ | ✗ |
| MMedBench [2024](https://arxiv.org/html/2412.01605v1#bib.bib26) | 53,566 | 文本 | ✗ | ✗ | ✗ |
| MedBench [2024b](https://arxiv.org/html/2412.01605v1#bib.bib21) | 300,901 | 文本 | ✓ | ✗ | ✗ |
| Asclepius [2024b](https://arxiv.org/html/2412.01605v1#bib.bib39) | 3,232 | 文本, 图像 | ✗ | ✗ | ✗ |
| GMAI-MMBench [2024b](https://arxiv.org/html/2412.01605v1#bib.bib4) | 26,000 | 文本, 图像 | ✗ | ✗ | ✗ |
| MedChain | 12,163 | 文本, 图像 | ✓ | ✓ | ✓ |

## 2 相关工作

### 2.1 大语言模型在医学中的评估

基准测试在作为关键绩效指标方面起着至关重要的作用，指导模型的改进，找出弱点，并塑造模型发展的方向。LLM在医学领域的评估主要集中在通过结构化评估测试通用医学知识。领先的基准测试如MultiMedQA Singhal等（[2023](https://arxiv.org/html/2412.01605v1#bib.bib31)）整合了多个医学QA数据集（例如，MedQA Jin等（[2021](https://arxiv.org/html/2412.01605v1#bib.bib15)），MedMCQA Pal等（[2022](https://arxiv.org/html/2412.01605v1#bib.bib23)）），重点关注医学执照考试材料的表现。其他基准测试如PubMedQA Jin等（[2019](https://arxiv.org/html/2412.01605v1#bib.bib16)）则专注于面向研究的查询，而一些中文医学基准测试如Wang等（[2023](https://arxiv.org/html/2412.01605v1#bib.bib40)）；Cai等（[2024](https://arxiv.org/html/2412.01605v1#bib.bib2)）则通过医学执照考试的多项选择题来评估模型。

虽然这些基准测试有效评估了通用医学知识，但它们未能捕捉到现实临床决策中三个关键方面（见[表 1](https://arxiv.org/html/2412.01605v1#S1.T1 "Table 1 ‣ 1 Introduction ‣ MedChain: Bridging the Gap Between LLM Agents and Clinical Practice through Interactive Sequential Benchmarking)")），即患者护理的个性化、临床咨询的互动性质，以及医学决策的顺序依赖性，每一步都建立在先前的发现之上。

### 2.2 基于LLM的医学代理

基于LLM的代理在各种医学应用中展现出显著的潜力，涵盖了诸如医学考试问题、临床诊断和治疗计划等任务。近期的研究探讨了不同的方法：Agent Hospital Li等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib19)）提供了医学场景模拟，而多个框架如Yue等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib45)）；Tang等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib33)）；Kim等人（[2024b](https://arxiv.org/html/2412.01605v1#bib.bib18)）专注于特定的医学阶段，采用多代理架构。一些研究针对特定方面，如CoD Chen等人（[2024a](https://arxiv.org/html/2412.01605v1#bib.bib3)）用于可解释诊断，Ehragent Shi等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib29)）则用于电子健康记录（EHRs）分析。其他研究，如Almanac Copilot Zakka等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib46)），则协助临床医生处理EMR特定任务。AI Hospital Fan等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib8)）探讨了互动临床场景，但在处理多模态医学影像时存在不足，且缺乏评估多代理性能的全面基准。为了增强这些代理的能力，研究人员已经集成了检索增强生成（RAG），例如MIRAGE Xiong等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib44)）的搜索增强框架和Medical Graph RAG Wu等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib42)）的基于知识的方法。

然而，现有方法面临两个主要限制。首先，现有框架关注孤立的医学任务，而不是提供跨不同临床阶段的无缝集成，因此对于需要有效阶段间沟通的复杂场景不够充分，Gronauer和Diepold（[2022](https://arxiv.org/html/2412.01605v1#bib.bib11)）指出了这一点。其次，当前医学RAG系统依赖基于块的索引，导致上下文不一致和计算低效，Huang和Huang（[2024](https://arxiv.org/html/2412.01605v1#bib.bib14)）；Gao等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib9)）强调了医学知识集成需要更复杂方法的问题。

## 3 MedChain基准

概述。我们介绍了MedChain，一个全面的临床决策基准，旨在模拟现实世界场景。MedChain建立在12,163个电子健康记录（EHRs）之上，涵盖了19个医学专业和156个子类别，其中包括7,338张带报告的医学影像。MedChain独特地强调了三个关键特点：

+   •

    个性化：每个案例都包含详细的患者档案，影响决策制定

+   •

    顺序性：案例涉及多个相互关联的决策制定阶段

+   •

    互动性：信息必须通过动态咨询主动收集

![参考说明](img/95ca8ce4329fe808a4c664b1f21c4a64.png)

图2：MedChain流程。MedChain由一系列顺序的医疗流程组成，包括专科转诊、病史采集、检查、诊断和治疗。

### 3.1 数据收集

数据来源与处理。我们的数据集来源于中国医疗网站“iiYi”¹¹1https://www.iiyi.com，该网站提供超过20,000个经过验证的临床案例，涵盖28个疾病类别。这些案例由专业医生验证，并进行了去标识化处理，以确保患者隐私。我们已获得网站管理员的正式许可，允许将数据用于科学研究目的。每个案例通常包含患者的主要诉求、病史、检查结果、治疗过程以及其他相关信息，确保MedChain的个性化。根据政府标准²²2《医疗项目和医学主题词国家标准》³³3https://www.ncbi.nlm.nih.gov/mesh/1000048，我们提取并整理了关键数据，包括患者基本信息、主要诉求、专科转诊、检查、影像报告、诊断和治疗。信息不完整的案例被剔除，最终保留了12,163个高质量案例。

质量控制。为了确保我们基准数据的最高数据完整性和临床相关性，我们实施了严格的质量控制流程，邀请了五位具有超过10年临床经验的资深医生组成评审小组。我们的评估过程对随机抽取的6,000个案例（占数据集的49.3%）进行了审查。每个案例从多个维度进行评估，包括疾病流行率、临床相关性、患者病史的准确性、诊断程序的适当性、诊断的正确性以及治疗建议的合理性。我们采用标准化的评分系统对这些维度的案例质量进行量化，并使用Cohen's kappa系数计算评审者之间的一致性。质量评估结果令人印象深刻，经过评估的案例中，有94.7%的案例达到了或超过了我们严格的质量标准。各维度的质量评分范围从92.9%到97.2%，显示出所有评估标准的一致高质量。我们的评审一致性分析得到了Cohen's kappa系数为0.82，表明专家评审之间有很强的共识。未达到标准的案例（5.3%）进行了修订或被排除在最终数据集之外，以保持基准的完整性。

### 3.2 临床工作流程模拟

顺序阶段。MedChain模拟了完整的临床工作流程，包括五个顺序任务，每个任务代表临床决策过程中的一个不同阶段，如[图2](https://arxiv.org/html/2412.01605v1#S3.F2 "图2 ‣ 3 MedChain基准 ‣ MedChain：通过互动顺序基准测试弥合大型语言模型（LLM）代理与临床实践之间的差距")所示。每个阶段的结果作为下一个阶段的输入，形成了一个依赖关系，其中后续决策受早期决策质量的影响。这一设计确保了MedChain的顺序性，模仿了现实世界临床决策过程的相互关联性。该流程包括：1）专科转诊：评估病例的紧急性并选择合适的科室；2）病史采集：通过医生与患者对话动态收集信息；3）检查：医学影像分析和报告生成；4）诊断：基于累积信息进行综合诊断；5）治疗：根据患者特定因素制定治疗方案。

这里简要概述了MedChain的构建流程。基准的详细内容可以参考[附录A](https://arxiv.org/html/2412.01605v1#A1 "附录A基准构建 ‣ MedChain：通过互动顺序基准测试弥合大型语言模型（LLM）代理与临床实践之间的差距")。我们在附录中展示了几个例子，[图4](https://arxiv.org/html/2412.01605v1#A1.F4 "图4 ‣ A.1 数据集标准化 ‣ 附录A基准构建 ‣ MedChain：通过互动顺序基准测试弥合大型语言模型（LLM）代理与临床实践之间的差距")也有展示。

![参考说明](img/1bf226c3a6156f50a633af2dee0a42dd.png)

图3：MedChain-Agent框架。展示了一个循环反馈的医学多任务系统，其中决策通过从医学数据库中检索类似的过往案例来支持。

### 3.3 互动环境

为了模拟真实医疗场景中的医生-患者会诊过程，我们开发了一个交互式环境，在该环境中，正在评估的基于大语言模型（LLM）的智能体必须通过动态互动积极收集信息。我们采用本地的大型语言模型 gemma2（9b）Team 等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib36)）作为患者智能体。该患者智能体初始化时拥有预定义的病例信息，但并不知道实际诊断，这使得它能够提供症状信息并以接近真实患者体验的方式回应询问。此设置确保了 MedChain 基准测试的互动性，评估 LLM 进行有效医疗会诊、提出相关问题并收集准确诊断和治疗计划所需关键信息的能力。该患者智能体设置的灵感来自医学教育和临床实践中的标准化患者。标准化患者是经过培训的个体，模拟真实患者，允许医疗专业人员在受控环境中练习临床和沟通技能，而无需承担与真实患者互动相关的风险（Barrows，[1993](https://arxiv.org/html/2412.01605v1#bib.bib1)）。

### 3.4 基准评估

由于医疗决策的复杂性，仅仅用正确或错误的二元评估是不够的。为了量化 CDM 结果的质量，我们为每个阶段开发了一个评估系统。每个阶段的标准答案包含多个关键点。被评估智能体的得分随着所涉及的标准点数增加而增加，而无关内容则导致得分下降。为实现这一方法，我们采用了交并比（IoU）度量。例如，在治疗阶段，智能体提出更多合理的治疗措施时，得分会提高。

## 4 MedChain-Agent 框架

### 4.1 带反馈的多智能体系统

MedChain-Agent 框架引入了一种新型的多智能体系统，旨在模拟医学决策过程的复杂性和互联性。该系统利用多个专门化智能体的集体智慧，每个智能体为整体决策过程贡献独特的专业知识。

#### 4.1.1 智能体角色

我们的框架包含三种不同类型的智能体，每种智能体在医疗决策流程中发挥着至关重要的作用：

通用智能体：这些专门的智能体是根据每个任务的具体要求招募的。例如，在任务 1 专业转诊中，通用智能体具备广泛的医学专业知识和分诊协议，使其能够有效地评估并将患者引导到合适的科室。这些智能体参与小组讨论，模拟医学会诊的协作性质。

汇总代理：在每个阶段，汇总代理整合一般代理的讨论和分析。该代理将集体的专业知识综合成一个连贯的总结，并为每个任务提供最终决策，模拟了医疗环境中高级医生或科室负责人的角色。

反馈代理：反馈代理在整个过程中的决策质量和准确性维持中起着至关重要的作用。该代理评估每个任务的输出，提供建设性反馈，并在必要时建议迭代改进。通过这样做，它创建了一个动态的自我纠正系统，不断完善其决策能力。

#### 4.1.2 决策制定

通过三种类型的代理，MedChain-Agent 执行一种复杂的决策过程，模拟了现实世界的医学实践。一般代理分析病人信息并进行协作讨论，分享评估和建议。汇总代理随后整合这些见解，权衡不同的视角，以制定初步决策。反馈代理审查这一决策，评估其适当性及对后续任务的影响。如果发现问题，反馈代理提供批评和建议，启动迭代改进过程。一般代理根据这些反馈重新考虑他们的评估，而汇总代理则对决策进行改进。这个循环持续进行，直到达成共识或完成预定的迭代次数，届时最终决策将被发布。

表 2：在 MedChain 中评估各种基于 LLM 的代理。每项任务的最佳表现以粗体突出显示。

| 框架 | 方法 | 专业推荐 | 病史采集 | 检查 | 诊断 | 治疗 | 平均 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 级别 1 | 级别 2 |
| 单一代理 | GPT-4o-mini [2023](https://arxiv.org/html/2412.01605v1#bib.bib22) | 0.5449 | 0.2871 | 0.3399 | 0.5112 | 0.4406 | 0.3930 | 0.4195 |
| Claude-3.5-sonnet [2023](https://arxiv.org/html/2412.01605v1#bib.bib35) | 0.5681 | 0.3050 | 0.3562 | 0.5018 | 0.4599 | 0.4053 | 0.4327 |
| LLaVA [2024a](https://arxiv.org/html/2412.01605v1#bib.bib20) | 0.3240 | 0.0730 | 0.3182 | 0.5165 | 0.4024 | 0.1060 | 0.2901 |
| Qwen2 [2024a](https://arxiv.org/html/2412.01605v1#bib.bib38) | 0.4975 | 0.2215 | 0.4226 | 0.4829 | 0.4818 | 0.2193 | 0.3876 |
|  | 实习生VL2 [2024a](https://arxiv.org/html/2412.01605v1#bib.bib38) | 0.4811 | 0.1935 | 0.4645 | 0.4490 | 0.4738 | 0.2903 | 0.3920 |
| 多代理 | MedAgent [2023](https://arxiv.org/html/2412.01605v1#bib.bib34) | 0.3830 | 0.2039 | 0.4454 | 0.4456 | 0.4266 | 0.3673 | 0.3786 |
| MDAgent [2024a](https://arxiv.org/html/2412.01605v1#bib.bib17) | 0.2398 | 0.1343 | 0.4240 | 0.4983 | 0.4289 | 0.3620 | 0.3479 |
| MedChain-代理 | 0.5873 | 0.3505 | 0.5836 | 0.6566 | 0.5218 | 0.4613 | 0.5269 |

### 4.2 MedCase-RAG

为了增强我们多智能体框架的决策能力，我们引入了MedCase-RAG，一种专为医疗环境量身定制的新型检索增强生成（RAG）技术。

与依赖非结构化医疗问答数据库的传统医疗RAG方法不同，MedCase-RAG采用了结构化的数据表示方法。我们将每个医疗案例映射为一个12维特征向量，涵盖了诸如年龄、性别、患者描述、症状描述、病史和患者图像等关键属性。这种结构化表示方法使得案例编码更加全面和标准化，从而促进了更准确和细致的检索。在这些特征中，我们将“症状描述”确定为最能代表患者病情的特征。该特征通过文本嵌入模型进行量化，作为密集检索任务的主要键。此外，MedCase-RAG还结合了动态数据库扩展机制，不断丰富其知识库。随着患者完成医疗过程并康复，他们的病例信息将作为伪数据重新引入数据库。这一方法使得系统能够从新案例中学习，并适应不断发展的医学知识和实践。

当呈现一个新的患者病例时，MedCase-RAG会在相关的医学科室内执行相似度搜索，使用余弦相似度识别出三个最相似的病例，提供更全面的决策依据，使智能体能够考虑不同的方面和潜在的结果。

## 5 实验

### 5.1 实验设置

我们将数据集分为训练集、验证集和测试集，比例为7:1:2。对于包含RAG技术的框架，训练集和验证集都用于构建案例检索数据库。本研究评估了单一代理和多代理系统。对于单一代理，我们测试了两个闭源模型（gpt-4o-mini OpenAI（[2023](https://arxiv.org/html/2412.01605v1#bib.bib22)）和claude-3.5-sonnet Team等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib35)））以及三个开源模型（InternVL2-8b Chen等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib5)），llava-llama-3-8b-v1_1 Liu等人（[2024a](https://arxiv.org/html/2412.01605v1#bib.bib20)），和Qwen2-7B-Instruct Wang等人（[2024a](https://arxiv.org/html/2412.01605v1#bib.bib38)）），模型权重来自官方Hugging Face仓库。在多代理评估中，我们将MedChain-Agent与MedAgent Tang等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib34)）和MDAgent Kim等人（[2024a](https://arxiv.org/html/2412.01605v1#bib.bib17)）进行了对比。所有多代理框架均基于InternVL2-8b Chen等人（[2023](https://arxiv.org/html/2412.01605v1#bib.bib5)）。部署是在LMDeploy框架下进行的，由贡献者（[2023](https://arxiv.org/html/2412.01605v1#bib.bib6)）提供支持。所有测试均在配备80GB内存的NVIDIA A100 GPU上执行。为了提高所有实验的输出稳定性和可靠性，我们始终将温度参数设置为0。

表3：MedChain-Agent关键组件的消融研究。本表展示了逐步去除反馈机制和MedCase-RAG后对完整MedChain-Agent框架性能的影响。

| 反馈 | MedCase-RAG | 专科转诊 | 病史采集 | 检查 | 诊断 | 治疗 | 平均 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 一级 | 二级 |
|  |  | 0.5523 | 0.2228 | 0.3285 | 0.6369 | 0.4982 | 0.3915 | 0.4384 |
| ✓ |  | 0.5739 | 0.2906 | 0.4222 | 0.6377 | 0.5086 | 0.4209 | 0.4757 |
|  | ✓ | 0.5928 | 0.3353 | 0.5801 | 0.6488 | 0.5035 | 0.4568 | 0.5195 |
| ✓ | ✓ | 0.5873 | 0.3505 | 0.5836 | 0.6566 | 0.5218 | 0.4613 | 0.5269 |

### 5.2 评估指标

为了评估模型的性能，我们采用了根据每个任务量身定制的多种评估指标。对于具有单一正确答案的任务，如专科转诊（一级），我们使用准确率作为评估标准。对于涉及多个关键点的任务，包括专科转诊（二级）、病史采集和治疗，我们应用交并比（IoU）来捕捉预测集与真实集之间的重叠部分。特别是对于检查任务，我们使用DocLens Xie等人（[2024](https://arxiv.org/html/2412.01605v1#bib.bib43)）来评估图像解读报告的质量。

### 5.3 实验结果与分析

我们在MedChain中的评估结果见于[表 2](https://arxiv.org/html/2412.01605v1#S4.T2 "表 2 ‣ 4.1.2 决策制定 ‣ 4.1 多智能体系统与反馈 ‣ 4 MedChain-Agent框架 ‣ MedChain：通过交互式顺序基准测试架起LLM代理与临床实践之间的桥梁")。我们的分析得出了三个重要的结论：

(1) 顺序决策任务仍然是一个重大挑战，即使对于先进的模型也是如此。例如，在单智能体框架中，GPT-4o-mini和InternVL2的平均得分分别为0.4442和0.3920。这些结果表明，尽管这些模型很复杂，但它们在临床决策的顺序阶段仍难以保持一致的表现，突显了这些任务的固有难度。

(2) 基于InternVL2的多智能体框架，如MedAgent和MDAgent，表现不如它们的单智能体对手。这种性能下降表明，传统的多智能体方法可能会加剧顺序决策过程中的错误传播，从而导致整体性能降低。相比之下，我们提出的MedChain-Agent显著优于这些多智能体方法，达到了0.5269的平均分。这一改进表明，MedChain-Agent有效地缓解了错误传播，提升了临床环境中决策的质量和可靠性。

(3) MedChain-Agent框架与开源LLM的结合展示了其明显优于如GPT-4o-mini等专有模型的优势。MedChain-Agent（平均得分为0.5269）所展现的显著性能提升意味着我们的框架可以利用开源LLM的优势，取得更优的结果。这表明，经过我们框架增强的开源模型不仅具有竞争力，而且在处理复杂的医疗决策任务时也能表现出色。

### 5.4 消融研究

表 4：MedChain中的三大关键特征的消融研究。本表展示了个性化、交互性和顺序性对诊断和治疗任务的影响。设置旁边的箭头$\uparrow\downarrow$表示预期的性能变化方向。结果旁边的箭头显示实际变化（当与预期匹配时，用灰色突出显示）。

| 设置 | 模型 | 诊断 | 治疗 |
| --- | --- | --- | --- |
| 完整 | MedAgent | 0.4266 | 0.3673 |
| MDAgent | 0.4289 | 0.3620 |
| gpt-4o-mini | 0.4406 | 0.3930 |
| InternVL2 | 0.4759 | 0.4472 |
| w/o Person. $\downarrow$ | MedAgent | 0.3274 $\downarrow$ | 0.3754$\uparrow$ |
| MDAgent | 0.3283$\downarrow$ | 0.3161$\downarrow$ |
| gpt-4o-mini | 0.4272$\downarrow$ | 0.3406$\downarrow$ |
| InternVL2 | 0.3966$\downarrow$ | 0.2527$\downarrow$ |
| w/o Seq. $\uparrow$ | MedAgent | 0.4839$\uparrow$ | 0.4456$\uparrow$ |
| MDAgent | 0.4199$\downarrow$ | 0.4418$\uparrow$ |
| gpt-4o-mini | 0.5096$\uparrow$ | 0.4423$\uparrow$ |
| InternVL2 | 0.4768 $\uparrow$ | 0.2903$\downarrow$ |
| 无交互. $\uparrow$ | MedAgent | 0.3315 $\downarrow$ | 0.4109 $\uparrow$ |
| MDAgent | 0.4295 $\uparrow$ | 0.3627 $\uparrow$ |
| gpt-4o-mini | 0.4988$\uparrow$ | 0.4003 $\uparrow$ |
| InternVL2 | 0.4861$\uparrow$ | 0.3173 $\downarrow$ |

MedChain 的三个关键特性：为了验证个性化、交互性和顺序性在我们基准中的有效性，我们进行了如[表 4](https://arxiv.org/html/2412.01605v1#S5.T4 "Table 4 ‣ 5.4 Ablation Study ‣ 5 Experiments ‣ MedChain: Bridging the Gap Between LLM Agents and Clinical Practice through Interactive Sequential Benchmarking")所示的消融研究。我们系统地去除每个特性，并观察其对模型在诊断和治疗任务中性能的影响。1) 去除患者特定信息（无个人信息）会导致所有模型在诊断任务中的表现持续下降（下降幅度从 3.0% 到 13.4% 不等）。这表明个性化信息对于准确的临床决策至关重要。2) 有趣的是，当去除阶段之间的顺序依赖性（无顺序性）时，大多数模型的表现得到了提升。这个提升实际上验证了顺序性在我们基准中的有效性，因为这表明顺序决策带来的挑战更大，更能反映真实世界中的临床场景。3) 同样，去除交互式信息收集（无交互性）后，模型性能的提升验证了交互性在我们基准设计中的有效性。这些结果共同表明，虽然顺序性和交互性使基准更加具有挑战性，但它们是更好地模拟真实世界临床决策过程复杂性的必要组成部分。

MedChain-Agent 的关键组件：为了评估我们框架中各个组件的影响，我们进行了消融实验，结果如[表 3](https://arxiv.org/html/2412.01605v1#S5.T3 "Table 3 ‣ 5.1 Experimental Setup ‣ 5 Experiments ‣ MedChain: Bridging the Gap Between LLM Agents and Clinical Practice through Interactive Sequential Benchmarking")所示。研究结果突显了反馈机制和 MedCase-RAG 模块在提升整体性能方面的关键作用。每个组件单独对各项指标都做出了显著的贡献。值得注意的是，单独使用 MedCase-RAG 模块可以将 Specialty Referral (Level 1) 提升至 0.5928，并在病史采集和检查方面带来显著提升。反馈机制和 MedCase-RAG 模块结合使用时，展现出了协同效应，达到了令人印象深刻的平均分数 0.5269。这个结果突显了这两个组件在优化我们框架能力方面的互补性。

## 6 结论

在本文中，我们介绍了MedChain，这是一个用于评估大型语言模型在临床决策中的新型基准，和MedChain-Agent，一个创新的多代理框架，旨在应对现实世界医学场景的复杂性。我们的工作通过将个性化、连续性和互动性纳入评估过程，弥合了当前AI能力与临床实践中细微现实之间的关键差距。MedChain-Agent的复杂多代理系统，通过反馈机制和MedCase-RAG模块的增强，在连续性临床决策任务中展现了前所未有的性能，甚至在与开源LLM结合时超过了专有模型。通过提供一个更现实和具有挑战性的评估框架，这项研究为评估和开发医学AI系统设定了新的标准，为其负责任地融入临床实践铺平了道路。

## 致谢

我们特别感谢iiyi网站的管理员，感谢他们慷慨地允许我们将其数据用于我们的研究目的。我们还要感谢Claude-3.5在校对我们稿件的语法准确性和协助创建LaTeX表格方面的帮助。

## 限制

本文有两个主要限制，提供了未来研究的方向：

+   •

    数据源多样性：MedChain基准是由12,163份电子健康记录构建的，这些记录来自中国医疗网站“iiYi”。尽管该数据集规模庞大，涵盖了19个医学专业和156个子类，但它来源于单一渠道。在我们的未来工作中，我们将纳入来自不同地区或医疗系统的额外数据源，以进一步丰富数据集，提供更广泛的临床场景，并提高基准的普适性。

+   •

    患者互动模拟：在我们的互动环境中，历史采集阶段的患者反应由Gemma 2语言模型生成。虽然这种方法确保了在评估基于LLM的代理时的一致性和可控性，但真实的患者互动可能更加多样化和复杂。未来的工作可以探索更先进的患者模拟器，或引入真实的对话数据，以捕捉更广泛的交流风格和行为。

## 参考文献

+   Barrows（1993）Howard S. Barrows. 1993. [标准化患者在教学和评估临床技能中的应用概述。aamc](https://api.semanticscholar.org/CorpusID:8488714)。*学术医学*，68:443–51。

+   Cai等（2024）Yan Cai, Linlin Wang, Ye Wang, Gerard de Melo, Ya Zhang, Yanfeng Wang, 和Liang He. 2024. Medbench：用于评估医学大型语言模型的大规模中文基准。在*美国人工智能会议论文集*，第38卷，第17709–17717页。

+   陈等人（2024a）陈俊颖、桂驰、高安宁哲、季可、王喜东、万翔、王本有。2024a。Cod：通过诊断链构建可解释的医疗代理。[arXiv预印本](https://arxiv.org/abs/2407.13301) arXiv:2407.13301。

+   陈等人（2024b）陈鹏程、叶金、王国安、李彦君、邓中英、李伟、李天斌、段昊东、黄子颜、苏彦周等人。2024b。Gmai-mmbench：面向通用医疗人工智能的全面多模态评估基准。[arXiv预印本](https://arxiv.org/abs/2408.03361) arXiv:2408.03361。

+   陈等人（2023）陈哲、吴建南、王文海、苏伟杰、陈国、邢森、钟沐然、张庆龙、朱熙洲、陆乐伟、李斌、罗平、卢彤、乔宇、戴季峰。2023。Internvl：扩展视觉基础模型并对齐通用视觉语言任务。[arXiv预印本](https://arxiv.org/abs/2312.14238) arXiv:2312.14238。

+   贡献者（2023）LMDeploy 贡献者。2023。Lmdeploy：用于压缩、部署和服务LLM的工具包。[https://github.com/InternLM/lmdeploy](https://github.com/InternLM/lmdeploy)。

+   埃里克森等人（2023）亚历山大·V·埃里克森、厄尔根·梅勒、杰斯珀·瑞格。2023。使用GPT-4诊断复杂临床病例。

+   范等人（2024）范志豪、唐佳龙、陈伟、王思远、魏忠宇、席俊、黄飞、周京仁。2024。Ai医院：作为实习医生用于临床诊断的LLM交互评估与协作。[arXiv预印本](https://arxiv.org/abs/2402.09742) arXiv:2402.09742。

+   高等人（2024）高云凡、熊云、高新宇、贾康翔、潘金琉、毕宇希、戴一、孙佳伟、王蒙、王昊峰。2024。[基于检索增强的生成在大型语言模型中的应用综述](https://arxiv.org/abs/2312.10997)。[*预印本*](https://example.org)，arXiv:2312.10997。

+   吉尔森等人（2023）艾登·吉尔森、康拉德·W·萨弗内克、托马斯·黄、维米格·苏克拉提斯、凌迟、理查德·安德鲁·泰勒、大卫·查塔什等人。2023。ChatGPT在美国医学执照考试（USMLE）中的表现如何？大型语言模型对医学教育和知识评估的影响。[*JMIR医学教育*](https://example.org)，9(1):e45312。

+   格罗诺厄和迪波尔德（2022）斯文·格罗诺厄、克劳斯·迪波尔德。2022。[多代理深度强化学习：综述](https://doi.org/10.1007/s10462-021-09996-w)。[*人工智能评论*](https://example.org)，第895-943页。

+   顾等人（2023）顾宇、邓翔、苏宇。2023。不要生成，进行判别：将语言模型基础于现实世界环境的提案。在[*ACL*](https://example.org)。

+   关等人（2023）关琳、卡尔西克·瓦尔梅卡姆、萨拉斯·斯里达兰、苏布拉奥·坎巴帕提。2023。利用预训练的大型语言模型构建并应用世界模型进行基于模型的任务规划。[*神经信息处理系统进展*](https://example.org), 36:79081–79094。

+   黄和黄（2024）黄一正、黄吉米。2024。[基于检索增强的文本生成在大型语言模型中的应用综述](https://arxiv.org/abs/2404.10981)。[*预印本*](https://example.org)，arXiv:2404.10981。

+   Jin 等人（2021）Di Jin、Eileen Pan、Nassim Oufattole、Wei-Hung Weng、Hanyi Fang 和 Peter Szolovits. 2021. 这个病人得了什么病？来自医学考试的大规模开放域问答数据集. *应用科学*，11(14):6421。

+   Jin 等人（2019）Qiao Jin、Bhuwan Dhingra、Zhengping Liu、William W Cohen 和 Xinghua Lu. 2019. Pubmedqa：一个生物医学研究问答数据集. *arXiv 预印本 arXiv:1909.06146*。

+   Kim 等人（2024a）Yubin Kim、Chanwoo Park、Hyewon Jeong、Yik Siu Chan、Xuhai Xu、Daniel McDuff、Cynthia Breazeal 和 Hae Won Park. 2024a. 医学决策中的大语言模型自适应协作策略. *arXiv 预印本 arXiv:2404.15155*。

+   Kim 等人（2024b）Yubin Kim、Chanwoo Park、Hyewon Jeong、Yik Siu Chan、Xuhai Xu、Daniel McDuff、Hyeonhoon Lee、Marzyeh Ghassemi、Cynthia Breazeal 和 Hae Won Park. 2024b. [Mdagents：面向医学决策的自适应大语言模型协作](https://arxiv.org/abs/2404.15155). *预印本*，arXiv:2404.15155。

+   Li 等人（2024）Junkai Li、Siyu Wang、Meng Zhang、Weitao Li、Yunghwei Lai、Xinhui Kang、Weizhi Ma 和 Yang Liu. 2024. [Agent hospital: 一个具备可进化医学代理的医院模拟系统](https://arxiv.org/abs/2405.02957). *预印本*，arXiv:2405.02957。

+   Liu 等人（2024a）Haotian Liu、Chunyuan Li、Qingyang Wu 和 Yong Jae Lee. 2024a. 视觉指令调优. *神经信息处理系统进展*，36。

+   Liu 等人（2024b）Mianxin Liu、Jinru Ding、Jie Xu、Weiguo Hu、Xiaoyang Li、Lifeng Zhu、Zhian Bai、Xiaoming Shi、Benyou Wang、Haitao Song 等人. 2024b. Medbench：一个全面、标准化、可靠的中文医学大语言模型评估基准系统. *arXiv 预印本 arXiv:2407.10990*。

+   OpenAI（2023）OpenAI. 2023. GPT-4v（视觉）系统卡. 技术报告，OpenAI。

+   Pal 等人（2022）Ankit Pal、Logesh Kumar Umapathi 和 Malaikannan Sankarasubbu. 2022. Medmcqa：一个大规模的多学科多选医学问答数据集. 载于 *健康、推理与学习会议论文集*，第248–260页。PMLR。

+   Papineni 等人（2002）Kishore Papineni、Salim Roukos、Todd Ward 和 Wei-Jing Zhu. 2002. Bleu：一种用于自动评估机器翻译的方法. 载于 *第40届计算语言学协会年会论文集*，第311–318页。

+   Qian 等人（2024）Chen Qian、Wei Liu、Hongzhang Liu、Nuo Chen、Yufan Dang、Jiahao Li、Cheng Yang、Weize Chen、Yusheng Su、Xin Cong 等人. 2024. Chatdev：面向软件开发的交流型代理. 载于 *第62届计算语言学协会年会论文集（卷1：长篇论文）*，第15174–15186页。

+   Qiu 等人（2024）Pengcheng Qiu、Chaoyi Wu、Xiaoman Zhang、Weixiong Lin、Haicheng Wang、Ya Zhang、Yanfeng Wang 和 Weidi Xie. 2024. 朝着构建面向医学的多语言模型迈进. *自然通讯*，15(1):8384。

+   Schmidgall et al. (2024) Samuel Schmidgall, Rojin Ziaei, Carl Harris, Eduardo Reis, Jeffrey Jopling, 和 Michael Moor. 2024. Agentclinic：一个用于评估模拟临床环境中AI表现的多模态代理基准。*arXiv预印本 arXiv:2405.07960*。

+   Sendak et al. (2020) Mark Sendak, Madeleine Clare Elish, Michael Gao, Joseph Futoma, William Ratliff, Marshall Nichols, Armando Bedoya, Suresh Balu, 和 Cara O’Brien. 2020. "人体是一个黑箱"：通过深度学习支持临床决策制定。在 *2020年公平、问责与透明会议论文集*，第99-109页。

+   Shi et al. (2024) Wenqi Shi, Ran Xu, Yuchen Zhuang, Yue Yu, Jieyu Zhang, Hang Wu, Yuanda Zhu, Joyce Ho, Carl Yang, 和 May D Wang. 2024. Ehragent：代码赋能大型语言模型在电子健康记录中的复杂表格推理。*arXiv预印本 arXiv:2401.07128*。

+   Shinn et al. (2024) Noah Shinn, Federico Cassano, Ashwin Gopinath, Karthik Narasimhan, 和 Shunyu Yao. 2024. Reflexion：具有语言强化学习的语言代理。*神经信息处理系统进展*, 36。

+   Singhal et al. (2023) Karan Singhal, Shekoofeh Azizi, Tao Tu, S Sara Mahdavi, Jason Wei, Hyung Won Chung, Nathan Scales, Ajay Tanwani, Heather Cole-Lewis, Stephen Pfohl, et al. 2023. 大型语言模型编码临床知识。*自然*, 620(7972):172-180。

+   Sutton et al. (2020) Reed T Sutton, David Pincock, Daniel C Baumgart, Daniel C Sadowski, Richard N Fedorak, 和 Karen I Kroeker. 2020. 临床决策支持系统概述：利益、风险及成功策略。*NPJ数字医学*, 3(1):17。

+   Tang et al. (2024) Xiangru Tang, Anni Zou, Zhuosheng Zhang, Ziming Li, Yilun Zhao, Xingyao Zhang, Arman Cohan, 和 Mark Gerstein. 2024. [Medagents: 将大型语言模型作为零-shot医学推理的协作伙伴](https://arxiv.org/abs/2311.10537)。*预印本*, arXiv:2311.10537。

+   Tang et al. (2023) Xiangru Tang, Anni Zou, Zhuosheng Zhang, Yilun Zhao, Xingyao Zhang, Arman Cohan, 和 Mark Gerstein. 2023. Medagents：将大型语言模型作为零-shot医学推理的协作伙伴。*arXiv预印本 arXiv:2311.10537*。

+   Team et al. (2023) Gemini Team, Rohan Anil, Sebastian Borgeaud, Yonghui Wu, Jean-Baptiste Alayrac, Jiahui Yu, Radu Soricut, Johan Schalkwyk, Andrew M Dai, Anja Hauth, et al. 2023. Gemini：一系列高效的多模态模型。*arXiv预印本 arXiv:2312.11805*。

+   Team et al. (2024) Gemma Team, Morgane Riviere, Shreya Pathak, Pier Giuseppe Sessa, Cassidy Hardin, Surya Bhupatiraju, Léonard Hussenot, Thomas Mesnard, Bobak Shahriari, Alexandre Ramé, et al. 2024. Gemma 2: 改进具有实际规模的开放语言模型。*arXiv预印本 arXiv:2408.00118*。

+   Tu et al. (2024) Tao Tu, Shekoofeh Azizi, Danny Driess, Mike Schaekermann, Mohamed Amin, Pi-Chuan Chang, Andrew Carroll, Charles Lau, Ryutaro Tanno, Ira Ktena, et al. 2024. 向通用生物医学人工智能迈进。*NEJM AI*, 1(3):AIoa2300138。

+   王等人 (2024a) 王鹏、白帅、谭思楠、王诗杰、范志豪、白金泽、陈克勤、刘雪晶、王嘉麟、葛文斌等人。2024a年。Qwen2-vl：增强视觉-语言模型在任意分辨率下的世界感知。*arXiv预印本 arXiv:2409.12191*。

+   王等人 (2024b) 王文轩、苏怡航、黄景远、刘洁、陈文婷、张宇迪、李承逸、张考荣、辛晓翰、沈琳琳等人。2024b年。Asclepius：一个针对医学多模态大语言模型的谱系评估基准。*arXiv预印本 arXiv:2402.11217*。

+   王等人 (2023) 王希东、陈贵名、宋定杰、张志毅、陈志红、肖清英、姜峰、李建全、万翔、王本友等人。2023年。Cmb：一个中文医学综合基准。*arXiv预印本 arXiv:2308.08833*。

+   王等人 (2024c) 王子龙、崔月东、钟立、张子敏、尹大、林宇晨、尚晶博。2024c年。Officebench：在多个应用中对语言代理进行基准测试以实现办公自动化。*arXiv预印本 arXiv:2407.19056*。

+   吴等人 (2024) 吴俊德、朱家源、祁云力。2024年。[医学图谱增强生成：通过图谱检索增强生成实现安全的医学大语言模型](https://arxiv.org/abs/2408.04187)。*预印本*，arXiv:2408.04187。

+   谢等人 (2024) 谢一青、张晟、程浩、刘鹏飞、泽拉勒姆·吉罗、黄崖、特里斯坦·诺曼、潘辉、卡罗琳·罗斯。2024年。Doclens：多方面细粒度医学文本评估。在*第62届计算语言学协会年会论文集（第1卷：长篇论文）*，第649-679页。

+   熊等人 (2024) 熊广志、金乔、卢志勇、张爱东。2024年。[医学领域检索增强生成基准测试](https://arxiv.org/abs/2402.13178)。*预印本*，arXiv:2402.13178。

+   岳等人 (2024) 岳玲、邢思雪、陈锦泰、傅天凡。2024年。[临床代理：基于大语言模型推理的临床试验多代理系统](https://arxiv.org/abs/2404.14777)。*预印本*，arXiv:2404.14777。

+   扎卡等人 (2024) 西里尔·扎卡、约瑟夫·乔、格雷西亚·法赫德、罗汉·沙德、迈克尔·穆尔、罗宾·方、达曼普里特·考尔、维什努·拉维、奥利弗·阿拉米、罗莎娜·达内什久等人。2024年。Almanac副驾驶：朝着自主电子健康记录导航迈进。*arXiv预印本 arXiv:2405.07896*。

+   张等人 (2019) 张天怡、瓦尔莎·基肖尔、费利克斯·吴、基利安·Q·温伯格、尤阿夫·阿尔茨。2019年。Bertscore：使用BERT评估文本生成。*arXiv预印本 arXiv:1904.09675*。

+   张等人 (2018) 张晓、吴吉、何志阳、刘贤、苏颖。2018年。基于大规模阅读理解的医学考试问题回答。在*人工智能领域的AAAI会议论文集*，第32卷。

+   (49) Yuchen Zhuang, Xiang Chen, Tong Yu, Saayan Mitra, Victor Bursztyn, Ryan A Rossi, Somdeb Sarkhel, 和 Chao Zhang. Toolchain*: 使用a*搜索在大规模语言模型中高效导航动作空间。在*第十二届国际学习表征会议*。

MedChain附录

摘要。

[附录 A](https://arxiv.org/html/2412.01605v1#A1 "附录 A 基准构建 ‣ MedChain：通过交互式顺序基准测试弥合LLM代理与临床实践之间的差距") 描述了MedChain基准数据集的标准化和组织过程。

[附录 B](https://arxiv.org/html/2412.01605v1#A2 "附录 B MedChain-Agent ‣ MedChain：通过交互式顺序基准测试弥合LLM代理与临床实践之间的差距") 提供了MedChain-Agent框架的详细解释，包括其实现、反馈机制，以及用于增强决策的创新型检索增强生成（RAG）方法。

[附录 C](https://arxiv.org/html/2412.01605v1#A3 "附录 C 实验补充 ‣ MedChain：通过交互式顺序基准测试弥合LLM代理与临床实践之间的差距") 列出了实验的附加细节。

## 附录 A 基准构建

### A.1 数据集标准化

我们采用了大规模语言模型与人工验证相结合的方法，在不同任务中标注数据。我们的方法包括针对任务的提示构建和输出匹配，旨在确保数据质量和多样性，同时保持与真实临床案例场景的一致性。

为确保基准的一致性和可比性，我们将检查项目的分类标准化为两大类：体格检查和辅助检查。体格检查包括对各种身体系统和一般健康指标的评估，而辅助检查涵盖了不同的影像学技术和实验室测试。我们利用 GPT-4o 从每个病例中提取并分类检查项目，随后进行人工验证以确保准确性。对于医学影像，我们将影像分为七种类型，并通过人工审查确保分类的正确性。此外，还从每个病例中提取并分类了治疗项目。该标准化过程确保了数据集的一致性，有助于对 LLM 性能进行准确且可比的评估。[图 5](https://arxiv.org/html/2412.01605v1#A1.F5 "图 5 ‣ A.1 数据集标准化 ‣ 附录 A 基准构建 ‣ MedChain: 通过互动式序列基准测试缩小大型语言模型 (LLM) 代理与临床实践之间的差距") 展示了不同科室的统计数据，[图 4](https://arxiv.org/html/2412.01605v1#A1.F4 "图 4 ‣ A.1 数据集标准化 ‣ 附录 A 基准构建 ‣ MedChain: 通过互动式序列基准测试缩小大型语言模型 (LLM) 代理与临床实践之间的差距") 展示了标准化后的一个病例。

![参见说明文字](img/8408c7363f14fe573d06a089f66690dd.png)

图 4：病例展示 “77_卵巢类癌伴成熟型囊性畸胎瘤：一例报告”。

![参见说明文字](img/0e46e915b19cdb3e3892968b4461b410.png)

图 5：多科室分布

### A.2 任务详情

本节提供了 MedChain 基准中五个具体任务的全面描述。每个子章节详细阐述了特定任务的输入、输出和评估方法。[图 6](https://arxiv.org/html/2412.01605v1#A1.F6 "图 6 ‣ A.2.5 任务 5: 治疗 ‣ A.2 任务详情 ‣ 附录 A 基准构建 ‣ MedChain: 通过互动式序列基准测试缩小大型语言模型 (LLM) 代理与临床实践之间的差距") 直观展示了 MedChain 与其他方法的区别。

#### A.2.1 任务 1：专科转诊

专科转诊任务评估大型语言模型（LLM）评估患者病情紧急程度并根据患者的主要投诉确定合适科室的能力。输入包括患者的主要投诉，输出空间包括19个一级科室和156个二级科室。LLM必须首先将患者分配到19个一级科室中的一个，然后根据主要症状将其分配到156个二级科室中的一个或多个。评估指标包括一级科室分配的准确度和二级科室分配的交并比（IoU）。IoU用于二级科室的评估，以考虑到可能有多个正确分配，并反映复杂病例中可能出现的部分正确性。这个指标更好地捕捉了临床实践中科室转诊的复杂性。

#### A.2.2 任务 2：病史采集

病史采集任务旨在模拟医生与患者的沟通，其目标是获取相关信息并推断必要的检查项目。我们采用多代理系统来评估这个过程：

+   •

    医生代理：评估中的大型语言模型（LLM）扮演这个角色，依据患者的回应提出问题并建议检查。

+   •

    患者代理：一个本地大型模型（如谷歌的gemma2/9b）模拟患者，根据预定义的病例信息进行回应。这些信息包括患者的主要投诉、病史和检查结果。

+   •

    提取代理：该代理从医生与患者代理之间的对话中提取医生询问或建议的检查项目。这些提取的项目形成输出，并与地面真实检查集进行比较。

评估指标是由提取代理（Extraction Agent）基于医生代理的询问和建议提取的检查项目与地面真实集（ground truth set）之间的交并比（IoU）。这种多代理设计模拟了一个真实的临床病史采集过程，允许大型语言模型展示其提问相关后续问题、解读患者回答和确定适当检查的能力。使用本地大型模型作为患者代理确保了评估的一致性，并提高了基准测试的可重复性。

#### A.2.3 任务 3：检查

该检查任务评估LLM分析医学图像并生成相应图像报告的能力。输入包括每个案例的医学图像，输出为自由文本格式的图像报告。此任务测试LLM解读视觉医学数据并以清晰、专业的方式表达结果的能力。鉴于医学报告的复杂性，传统的自然语言处理指标，如BLEU Papineni等（[2002](https://arxiv.org/html/2412.01605v1#bib.bib24)）和BERTScore Zhang等（[2019](https://arxiv.org/html/2412.01605v1#bib.bib47)），对于评估该任务并不充分，因为它们未能捕捉生成的报告是否在医学主张上与实际情况一致。相反，我们采用了DocLens Xie等（[2024](https://arxiv.org/html/2412.01605v1#bib.bib43)）提出的Claim Recall指标来评估生成报告的完整性。首先，使用GPT-4o-mini从原始地面真实报告中提取主张列表。然后，GPT-4o-mini评估生成的报告是否包含这些参考主张，召回率得分衡量在生成的报告中正确反映的主张的比例。用于此评估的提示可在[图7](https://arxiv.org/html/2412.01605v1#A1.F7 "Figure 7 ‣ A.2.5 Task 5: Treatment ‣ A.2 Tasks Details ‣ Appendix A Benchmark Construction ‣ MedChain: Bridging the Gap Between LLM Agents and Clinical Practice through Interactive Sequential Benchmarking")中找到。

#### A.2.4 任务 4：诊断

诊断任务评估LLM根据提供的症状和检查结果识别患者疾病的能力。输入包括患者的主诉、病史、检查结果以及就诊科室。输出为自由文本格式的诊断。我们使用五级评分系统来评估诊断的准确性，评分范围从完全不准确到完全准确。这个分级系统允许更细致地评估LLM的诊断能力，因为诊断可能是部分正确的或以不同的方式表达。该系统考虑到医学诊断的复杂性，其中多个因素可能影响患者的病情。五级评分系统如下：

1.  1.

    完全不准确（诊断与实际诊断完全不一致）

1.  2.

    大部分不准确（大多数诊断与实际诊断不一致）

1.  3.

    部分准确（部分诊断与实际诊断一致，但整体差异较大）

1.  4.

    大部分准确（大多数诊断与实际诊断一致）

1.  5.

    完全准确（诊断与实际诊断完全一致）

#### A.2.5 任务 5：治疗

治疗任务涉及根据患者的诊断和检查结果制定治疗计划。输入包括患者的主诉、病史、检查结果和诊断。输出是一组建议的治疗项目。评估指标是建议的治疗与真实治疗集之间的 IoU。由于可能有多种治疗方案适用，IoU 允许部分得分，当 LLM 提出一个推荐治疗的子集或提出额外的合理治疗（这些治疗不在真实治疗集内）时，这种方式允许部分得分。此任务考察了 LLM 综合信息并应用医学知识制定适当治疗计划的能力，考虑因素包括药物相互作用、治疗方案以及患者特定情况。

![参见说明](img/6bfd8c31c42926ea49ae85a430b5dde9.png)

图 6：我们基准方法与之前基准方法的对比。在图 (a) 中，展示了之前工作中使用的基准方法，这些方法基于特定领域的问题，无法实现完整的端到端医疗任务工作流程。在图 (b) 中，展示了我们提出的基准方法，我们通过提出的 MCase-RAG 方法和 ACFM 机制，成功实现了医疗任务的完整工作流程。

![参见说明](img/e9b3749eb00adc0cba0f60fa5e122945.png)

图 7：提取参考声明和蕴含评估的提示。

### A.3 检查项目

体格检查：一般检查（包括身高、体重、体温、血压、脉搏等）、头部、眼睛、耳朵、鼻子和喉咙检查、颈部检查（包括甲状腺、颈部淋巴结）、胸部检查（包括肺、心脏）、腹部检查、脊柱和四肢检查、皮肤检查、神经系统检查、泌尿生殖系统检查。

辅助检查：X 射线、MRI、CT、超声、核医学影像学、血液检查、尿液检查、大便检查、内窥镜检查、病理检查。

### A.4 治疗项目

手术、介入治疗、药物治疗、化疗、抗生素治疗、放射治疗、物理治疗、免疫治疗、心理治疗、传统中医治疗、基因治疗。

![参见说明](img/db23b962272acd6670e47a30ca01e40a.png)

图 8：我们 MedChain-Agent 中每个任务的具体代理设计以及整个过程的 ACFM 方案。

## 附录 B MedChain-Agent

### B.1 实施细节

我们框架的整体流程和输出流程在[图 8](https://arxiv.org/html/2412.01605v1#A1.F8 "Figure 8 ‣ A.4 Treatment Items ‣ Appendix A Benchmark Construction ‣ MedChain: Bridging the Gap Between LLM Agents and Clinical Practice through Interactive Sequential Benchmarking")中进行了说明。患者首先描述自己的病情，随后任务 1 执行专科转诊，将患者分配到适当的初级和二级科室。任务 1 完成后，由相应初级科室的专家组组成医生团队，从而促进更好的分析决策。任务 2 涉及这些专家根据患者当前的情况开具合适的医学检查。任务 3 主要分析患者的影像数据，生成详细且全面的影像报告。任务 4 由专家们基于任务 2 的结果和任务 3 的影像报告进行综合分析，为患者提供初步诊断。最后，任务 5 涉及专家根据所有前述任务的结果和分析，制定合适的治疗方案。

此外，在上述描述中，所有任务的决策和分析过程都是通过医生团队的讨论进行的。具体来说，来自同一科室的三位专家首先进行讨论和分析，然后将他们的发现和结果总结给最终的全科医生（主治医生）以作出最终决定。在每个步骤中，都会从我们的医学数据库中检索相关的相似案例，以帮助决策。对于任务 1，我们将基于思维链（CoT）方法，将识别初级科室和二级科室的任务分为两个子任务：首先识别初级科室，然后识别二级科室。同样，任务 2 中，我们首先开具具体的检查，再进行后续的检查，从而优化决策过程。

一旦患者完成整个医疗过程，将编制一份综合治疗跟踪记录，包含每个阶段的治疗结果和报告，以及患者的信息。随后，这些数据将重新引入我们的医学数据库。由于这些数据尚未完全验证（我们无法判断当前病例的决策合理性），我们将根据半监督学习的原则，将这些数据视为伪数据，并赋予其较低的优先级。这意味着我们将首先从完全验证过的来源中检索数据，如果检索失败或数据不足，我们将转而从伪数据中进行检索。

### B.2 反馈机制详情

到目前为止，尚未有工作提出一种多智能体框架来模拟整个医疗过程。尽管现有的框架在特定医疗任务中展现了效率，但在将各个医疗阶段连接起来时，其性能仍不尽如人意。在顺序任务场景中，简单地将单个任务串联起来是不可行的。因此，我们的全流程任务可以视为一个多序列任务，这就需要深入探讨错误传播的问题。当第一个任务出现问题时，随后的任务将基于错误的结果进行分析和决策，可能会对整个过程产生严重影响。

为了解决这个问题，我们在全流程框架中引入了一个反馈机制，紧密地将当前任务与所有后续任务连接起来（如图6所示）。当前任务完成后，后续任务的医生将对输出结果进行评估（反馈判断小组）。只有当结果被确认准确时，过程才会推进到下一个任务；如果发现问题，将输出错误原因和改进建议，并反馈给当前任务进行重新讨论和决策。这个过程将持续迭代，直到对结果达成共识或达到最大讨论轮次为止。

通过在每个任务之间实施反馈机制，我们可以有效地管理错误的传播，同时显著增强智能体小组之间的协作与沟通。该机制鼓励智能体实时共享信息，提升相互理解，并在发现问题时迅速进行战略调整，从而增强系统的整体灵活性和适应性。每个智能体能够更好地应对动态环境中的变化，从而促进更高效的医疗服务。这个基于反馈的协作模型为多智能体系统的高效运作奠定了基础，有助于在复杂临床环境中提供精确可靠的医疗决策支持。

### B.3 RAG 细节

我们对原始数据集进行了数据重构，其中每个病例通过年龄、性别、病人描述、症状描述、病史和病人影像等属性映射到一个12维的特征向量。在这些属性中，“症状描述”被确定为当前病人最具代表性的特征，并通过文本嵌入模型进行量化，存储在数据库中，以供后续的密集检索任务使用。

以往的 Medical-RAG 方法依赖于医学问答（QA）数据库，主要使用分块索引进行检索。我们的做法在多个方面有所不同（如图 5 所示）。首先，我们基础医学数据库的内容是独特的；大多数方法通过医学 QA 数据构建了他们的数据库，而我们则采用树状结构。我们最初根据主要医学科室对患者信息进行分类（在实验部分，我们将其分类为 19 个主要科室），然后将患者信息提取并映射到二维特征表示中，如图 4 所示。这种存储设计有助于更好地保留患者的重要临床信息，以便辅助决策。其次，我们的检索方法也与他们有所不同。在我们的检索过程中，我们模拟医生的日常实践。当遇到需要决策的复杂病例时，医生通常会参考过去的案例，以增强当前的决策和判断。我们将这些二维特征视为病例的最小单位，以“症状描述”作为检索的基础。当新患者到来时，我们提取并精炼其“症状描述”特征（约 70 个字符）。我们采用直接的定量匹配，而不对该特征进行标记化，使用文本嵌入模型进行量化。得到的特征向量会与数据库中相应科室的每个案例通过余弦相似度计算进行比较，从中选择症状相似度最高的前三个案例作为当前的检索结果。这些结果与当前病例的特征一同转发给后续的代理进行全面决策和判断，从而增强代理的输出。由于我们的检索方法不使用文档分块，而是采用直接匹配，因此能够保留更多匹配信息，从而提高匹配的准确性。

### B.4 任务提示

[图 9](https://arxiv.org/html/2412.01605v1#A2.F9 "图 9 ‣ B.4 任务提示 ‣ 附录 B MedChain-Agent ‣ MedChain：通过互动式顺序基准测试架起 LLM 代理与临床实践之间的桥梁") $\sim$ \autopagereffig:prompt_task45 展示了我们 MedChain-Agent 框架中每个任务和阶段的提示。

![参见说明文字](img/a701795a444bc6ce999fac0e911edcb3.png)

图 9：MedChain-Agent 中任务 1 的提示。

![参见说明文字](img/249a3b529b877fdd6e4ea214412e8153.png)

图 10：MedChain-Agent 中任务 2 的提示。

![参见说明文字](img/f14a4fc917e7b2c71a82c91d43aa361c.png)

图 11：MedChain-Agent 中任务 3 的提示。

![参见说明文字](img/6bf77a7fa933ac458ffd838850c80e23.png)

图 12：MedChain-Agent 中任务 4 和任务 5 的提示。

## 附录 C 实验补充材料

任务 1 和任务 2 基于“思维链（CoT）”推理方法进行细分，以支持决策过程。因此，任务 1 被分为“专科转诊（一级）”和“专科转诊（二级）”，以评估初级和次级部门的表现。任务 2 则被划分为“体格检查”和“辅助检查”，分别代表体检和辅助检查的表现。对于消融和对比实验，我们将数据集按 7:3 的比例划分为训练集和测试集。从每个训练集案例中提取了 12 维特征，并将其存储在我们的医学数据集中，供后续的检索任务使用。
