<!--yml

类别: 未分类

日期: 2025-01-11 11:42:29

-->

# 规划、生活与评估：基于多智能体 LLM 的循环城市规划框架

> 来源：[https://arxiv.org/html/2412.20505/](https://arxiv.org/html/2412.20505/)

Hang Ni, Yuzhi Wang, Hao Liu

###### 摘要

城市再生在城市化背景下面临重大挑战，需要采取适应性的方法来应对不断变化的需求。利用大语言模型（LLM）的进展，我们提出了循环城市规划（CUP），这是一种在闭环中不断生成、评估和完善城市规划的新范式。具体而言，我们的基于多智能体 LLM 的框架包括三个关键组成部分：（1）规划，在这一部分，LLM 智能体基于上下文数据生成和完善城市规划；（2）生活，在这一部分，智能体模拟居民的行为和互动，模拟城市环境中的生活；（3）评估，评估规划效果并提供改进的迭代反馈。这个循环过程使得规划方法具有动态性和响应性。基于实际数据集的实验表明，我们的框架作为一个持续的适应性规划过程，其有效性得到了验证。

## 引言

随着过去几十年城市化进程的迅速推进，许多现有的城市结构已无法满足当前的需求，迫切需要持续的城市再生，以创造更宜居的环境 （Qian et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib11)）。传统的城市规划方法包括由政府和城市规划师主导的自上而下的范式，以及强调公众参与的协作决策的参与式范式 （Li et al. [2020](https://arxiv.org/html/2412.20505v1#bib.bib7)）。为了提高有效性，近年来的研究越来越多地聚焦于利用机器学习（ML）技术 （Zheng et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib18); Wang et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib15); Qian et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib11)）。最近，大语言模型（LLM）显著的泛化能力使得以 LLM 为动力的多智能体框架作为强大的城市规划工具逐渐兴起 （Zhou et al. [2024](https://arxiv.org/html/2412.20505v1#bib.bib19)）。

尽管这些进展显著，但现有的城市规划方法在适应城市环境持续变化和动态特性方面仍面临重大局限性。传统的规划方法通常依赖于静态的、一时的干预措施，缺乏灵活性，难以应对不断变化的社区需求或应对不可预见的情况。为了解决这一局限性，我们提出了循环城市规划（CUP）这一新型范式，强调长期的、迭代的规划更新。CUP旨在建立一个闭环规划过程，其中城市规划不断地被评估、完善和调整，从而确保对城市动态变化的响应能力 （Chigbu 等人 [2016](https://arxiv.org/html/2412.20505v1#bib.bib2); Ramezani 和 Nooraie [2023](https://arxiv.org/html/2412.20505v1#bib.bib12)）。

然而，CUP中的一个根本性挑战是如何有效地评估和改进城市规划的迭代过程 （Oliveira 和 Pinho [2010](https://arxiv.org/html/2412.20505v1#bib.bib8); Wang 等人 [2023](https://arxiv.org/html/2412.20505v1#bib.bib15)）。生活质量（QOL），包括居民福祉的定量和定性衡量，是评估城市规划有效性的一项关键指标。然而，传统的评估方法，如观察研究和居民调查，通常劳动强度大且耗时 （Santos 和 Martins [2007](https://arxiv.org/html/2412.20505v1#bib.bib13); Wang 等人 [2023](https://arxiv.org/html/2412.20505v1#bib.bib15)），这限制了它们的扩展性，并且限制了评估的频率。虽然基于代理的建模（ABM）已成为一种计算替代方法，用于自动化评估过程的部分环节 （Hosseinali, Alesheikh 和 Nourian [2013](https://arxiv.org/html/2412.20505v1#bib.bib5); González-Méndez 等人 [2021](https://arxiv.org/html/2412.20505v1#bib.bib4)），但ABM方法通常依赖于僵化的、预设的规则或狭窄关注的机器学习模型。这种僵化性限制了它们适应复杂多变城市情境的能力 （Gao 等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib3)）。

本文提出了一种基于大语言模型（LLM）的多代理框架，旨在支持CUP，集成了闭环中的三个迭代阶段：(1) 规划阶段，其中LLM代理协作生成和完善城市规划，涉及规划者和居民；(2) 生活阶段，其中基于LLM的ABM模拟居民的行为和互动，以监控城市生活；(3) 评判阶段，自动评估生活质量（QOL）并生成改进城市规划的建议，以便在下一个规划周期中实施。我们通过对北京市回龙观社区的案例研究验证了我们的方法，展示了其在提升城市规划成果方面的有效性。

![参见标题](img/a73386369d6a8472928f04506f8ddb9e.png)

图1：框架概述。

## 相关工作

城市规划。传统的城市规划方法，包括自上而下的规划和参与式方法，虽然是基础性的方法，但在适应性和可扩展性方面面临局限性（Taylor [1998](https://arxiv.org/html/2412.20505v1#bib.bib14)；Arnstein [1969](https://arxiv.org/html/2412.20505v1#bib.bib1)；Lane [2005](https://arxiv.org/html/2412.20505v1#bib.bib6)）。近年来的研究通过引入机器学习（ML）来提升城市规划，自动化决策过程并改善可扩展性（Zheng 等人 [2023](https://arxiv.org/html/2412.20505v1#bib.bib18)；Wang 等人 [2023](https://arxiv.org/html/2412.20505v1#bib.bib15)；Qian 等人 [2023](https://arxiv.org/html/2412.20505v1#bib.bib11)）。大语言模型（LLM）的兴起进一步推动了城市规划能力的发展，使得复杂的多代理协作成为可能，从而推动共识的建立（Zhou 等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib19)）。然而，现有的方法主要集中于一次性规划，缺乏适应性城市规划所需的迭代闭环特性（Chigbu 等人 [2016](https://arxiv.org/html/2412.20505v1#bib.bib2)；Ramezani 和 Nooraie [2023](https://arxiv.org/html/2412.20505v1#bib.bib12)）。

基于LLM的仿真。基于代理的建模（ABM）长期以来一直用于通过模拟代理之间的交互来模拟复杂的城市动态（Hosseinali, Alesheikh, 和 Nourian [2013](https://arxiv.org/html/2412.20505v1#bib.bib5)；González-Méndez 等人 [2021](https://arxiv.org/html/2412.20505v1#bib.bib4)）。LLM（大语言模型）已成为增强这些仿真的强大工具，能够在人类级别上进行推理、解释和适应各种城市情景（Gao 等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib3)）。基于LLM的仿真已应用于多个领域，如社交网络、流动模式和城市活动建模（Park 等人 [2022](https://arxiv.org/html/2412.20505v1#bib.bib10)；Wang 等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib16)；Yan 等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib17)）。在本研究中，我们利用基于LLM的ABM来模拟居民的流动性和社会行为，从而提供对城市生活的更全面理解。

## 方法论

问题陈述。给定一个被划分为多个小区域的城市区域 $\mathcal{A}$，这些小区域为 $\{a_{1},a_{2},\dots,a_{N_{a}}\}\in\mathcal{A}$，其中 $N_{a}$ 是区域的总数，我们将城市规划定义为一个映射 $P:\mathcal{A}\rightarrow\mathcal{U}$。每个区域 $a_{i}$ 被分配一个土地使用类型 $u_{i}=P(a_{i})\in\mathcal{U}$，其中 $\mathcal{U}$ 代表土地使用类型的集合。目标是通过不断评估城市动态的影响并相应调整土地使用分配，迭代地优化城市规划 $P$。

框架概述。图[1](https://arxiv.org/html/2412.20505v1#Sx1.F1 "图 1 ‣ 介绍 ‣ 规划、生活和评判：基于多代理的大语言模型循环城市规划框架")展示了我们循环城市规划框架的整体工作流程，包括规划、生活和评判。流程从规划模块开始，该模块通过整合之前评估的反馈和建议，迭代地完善城市规划。接下来是生活阶段，在这一阶段，常驻代理的生活被模拟，捕捉他们在当前规划下的流动性和社会行为。最后，评判阶段评估规划对城市生活质量（QOL）的影响，并提供进一步调整的建议。这些阶段在闭环中反复进行，确保城市规划能够持续适应并优化，以应对不断变化的条件和不断演化的常驻人员需求。

档案制作。我们的框架包括三种类型的大语言模型代理：规划者 $\mathbf{P}$、评判者 $\mathbf{J}$ 和常驻人员 $\mathbf{R}_{i},\ i=1,2,...,N_{r}$，这些代理被分配到特定的角色档案中。规划者代理负责整合讨论结果、改进建议和其高层次的规划专家知识，进而起草和修订城市规划。同时，我们引导评判者代理反思定量和定性分析结果，并为计划更新提供反馈。

常驻代理对于我们工作流程中的协作决策至关重要，特别是在规划、生活模拟和评判过程中的定性调查，因此有必要量身定制常驻人员的档案技术。具体来说，我们使用大语言模型（LLM）自动并单独地为每个常驻人员建立档案，避免了昂贵的人工档案制作，并且在常驻人员数量增加时，避免了超出上下文令牌限制的问题。对于每个常驻人员的档案制作，我们首先从人口数据中抽取基本属性（*例如*，年龄、性别等），以便与现实世界的人口分布相一致。然后，我们利用提示链（prompt chaining）逐步生成代理的个性、职业、爱好，甚至生活方式和追求，确保档案的一致性和丰富性。此外，在为后续常驻人员建立档案时，我们避免使用之前常驻人员生成的属性，以限制档案的重复性。

规划。规划阶段的目的是通过LLM的强大能力反复生成并完善城市规划。受到(Zhou等人 [2024](https://arxiv.org/html/2412.20505v1#bib.bib19))的启发，我们通过结合城市规划者和公众参与的方式来实施规划过程，以提高效率，满足规划者和居民代理的需求，如图[1](https://arxiv.org/html/2412.20505v1#Sx1.F1 "Figure 1 ‣ Introduction ‣ Planning, Living and Judging: A Multi-agent LLM-based Framework for Cyclical Urban Planning")(a)所示。规划的工作流程在第$i$轮迭代中如下所示：

|  | $\displaystyle\tilde{P}_{k}$ | $\displaystyle=\mathbf{P}.\text{plan}(K,P_{k-1},S_{k-1}),$ |  | (1) |
| --- | --- | --- | --- | --- |
|  | $\displaystyle D_{k}$ | $\displaystyle=\text{discuss}(\{\mathbf{R}_{i}\}_{i=0}^{N_{r}},P_{k-1}),$ |  | (2) |
|  | $\displaystyle P_{k}$ | $\displaystyle=\mathbf{P}.\text{plan}(K,\tilde{P}_{k},S_{k-1},D_{k}).$ |  | (3) |

特别地，规划者代理首先通过专家知识$K$和上一轮迭代的建议$S_{k-1}$修改前一个计划$P_{k-1}$。然后，居民代理被引导进入讨论，以平衡彼此不同的利益，讨论的动机来自他们的个人资料和先前的生活经历（如果$k \geq 2$）。最后，讨论结果$D_{k}$由规划者总结并进一步优化计划。注意，$P_{0}$在第一次迭代时会初始化为一些待确定的空闲区域（*即*，除了住宅区以外）。

生活。生活阶段采用由LLM赋能的ABM作为传统资源密集型监控范式的替代方案，主要包括两个组成部分：（1）模拟居民在该区域的日常活动轨迹和感受的流动行为（见图[1](https://arxiv.org/html/2412.20505v1#Sx1.F1 "Figure 1 ‣ Introduction ‣ Planning, Living and Judging: A Multi-agent LLM-based Framework for Cyclical Urban Planning")(b.1)）。（2）模拟居民通过社交媒体传播对该区域的经验和意见的社会行为（见图[1](https://arxiv.org/html/2412.20505v1#Sx1.F1 "Figure 1 ‣ Introduction ‣ Planning, Living and Judging: A Multi-agent LLM-based Framework for Cyclical Urban Planning")(b.2)）。生活阶段在时刻$t$的更新公式如下所示（为了简洁起见，省略了迭代下标$k$）：

|  | $\displaystyle M_{i}(t),L_{i}(t),N_{i}(t)=\mathbf{R}_{i}.\text{live}(M_{i}(t-1)% ,E(t-1)),$ |  | (4) |
| --- | --- | --- | --- |
|  | $\displaystyle E(t)=\text{sync}(E(t-1),\{L_{i}(t),N_{i}(t)\}_{i=0}^{N_{r}}),$ |  | (5) |

其中，$L_{i}$表示出行行为（*即*，$\mathbf{R}_{i}$的地理位置），$N_{i}$表示社交行为（*即*，$\mathbf{R}_{i}$在社交媒体上发布的帖子或评论）。每个居民都配备有一个动态记忆池$M(t)$，用于记录代理人的居住体验。演化环境$E(t)=\{E_{R}(t),E_{S}(t)\}$是居民生活过程中物理区域与社交媒体的结合，并且这两个部分是同步更新的。

具体而言，为了服务上述模拟，我们参考 (Park et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib9))来设计生活模拟中的代理人架构。对于每一步生活，居民首先感知环境中的发生事件，然后规划下一步行为（*即*，出行和社交行为）以便潜在执行。代理人还会被促使反思自己的经历，得出高阶的思考。记忆池用于存储事件、行为和思维，并通过记忆检索促进有效的规划和反思。

判断。判断过程依赖于大型语言模型（LLM）提供面向现实的评估，并根据生活模拟的定量和定性分析结果对规划改进提出建议，如图[1](https://arxiv.org/html/2412.20505v1#Sx1.F1 "Figure 1 ‣ Introduction ‣ Planning, Living and Judging: A Multi-agent LLM-based Framework for Cyclical Urban Planning")(c)所示。判断的工作流程如下：

|  | $\displaystyle Q_{k,1}$ | $\displaystyle=\text{automatic}(P_{k},E_{k}(T),\{\mathbf{R}_{i}\}_{i=0}^{N_{r}}),$ |  | (6) |
| --- | --- | --- | --- | --- |
|  | $\displaystyle Q_{k,2}$ | $\displaystyle=\text{interview}(\{\mathbf{R}_{i}\}_{i=0}^{N_{r}}),$ |  | (7) |
|  | $\displaystyle R_{k}$ | $\displaystyle=\text{Avg}(Q_{k,1},Q_{k,2}),$ |  | (8) |
|  | $\displaystyle S_{k}$ | $\displaystyle=\mathbf{J}.\text{suggest}(Q_{k,1},Q_{k,2}).$ |  | (9) |

为了研究计划的效果，我们参考 (Zhou et al. [2024](https://arxiv.org/html/2412.20505v1#bib.bib19))并通过自动化手段进行城市规划$P_{k}$的定量统计，例如可达性（*即*，各类土地使用的平均覆盖率）和生态性（*即*，绿化土地使用的覆盖率）。此外，我们通过问卷对居民进行定性访谈，收集居住体验评分（百分比制）。请注意，我们在当前的研究中只使用了部分生活质量（QOL）指标，综合评估维度将在未来的研究中考虑。之后，我们收集定量和定性分析结果$Q_{k,1},Q_{k,2}$，并报告当前规划$P_{k}$的整体有效性$R_{k}$。进一步地，我们利用判断代理人对规划改进建议$S_{k}$进行讨论。

## 实验

实验设置。根据(Zheng et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib18); Zhou et al. [2024](https://arxiv.org/html/2412.20505v1#bib.bib19))，我们在位于北京市中心以北33公里的3.74平方公里的回龙观社区测试了我们的框架。在实验中，我们使用了GPT-4o并将温度设置为0以保证稳定性。我们预先生成了30个居民代理，并实施了3次迭代的框架。每次迭代模拟一天，模拟的时间粒度为一分钟。为了证明我们的优越性，我们将框架与随机规划方法、基于深度强化学习（DRL）的方法(Zheng et al. [2023](https://arxiv.org/html/2412.20505v1#bib.bib18))和基于多智能体LLM的方法(Zhou et al. [2024](https://arxiv.org/html/2412.20505v1#bib.bib19))进行了比较。需要注意的是，MA-LLM方法仅通过一次迭代实例化我们的框架，并通过随后的生活和评判过程进行评估。这四个评估指标来自评判程序，包括可达性、生态和体验。

表 1: 规划效果（%）。

| 方法 | 可达性 | 生态 | 体验 |
| --- | --- | --- | --- |
| 随机 | 61.67 | 50.00 | 65.17 |
| DRL | 66.25 | 56.67 | 64.23 |
| MA-LLM (我们${}_{-1st})$ | 65.00 | 73.33 | 65.03 |
| 我们[-2nd] | 62.50 | 56.67 | 66.6 |
| 我们[-3rd] | 64.17 | 53.33 | 69.03 |

结果。我们框架与两个基准方法的比较结果如表[1](https://arxiv.org/html/2412.20505v1#Sx4.T1 "Table 1 ‣ Experiment ‣ Planning, Living and Judging: A Multi-agent LLM-based Framework for Cyclical Urban Planning")所示。我们总结了以下观察结果：首先，我们的框架在体验指标上通常优于基准方法，并且随着循环次数的增加，效果逐渐提高，经过3次迭代后，效果达到了69.03%，这表明居民的平均生活体验得分为69.03%。这些结果表明，我们的框架能够有效平衡居民的需求，并具有通过不断迭代规划改进来持续提升居民生活体验的潜力。其次，从定量角度来看，基于DRL的方法在可达性方面表现最佳，因为DRL特别针对优化更高的宏观可达性而设计。此外，我们观察到框架在可达性和生态指标上随着循环的进行出现结果下降，这可能源于定量和定性因素之间的冲突。因此，我们推测，主观人类幸福感的提升可能需要牺牲土地使用的有效空间布局。

![参考说明](img/63b59195385d35b24741366792fc9f5f.png)

图 2: 案例研究 $\mathbf{R}_{19}$。

案例研究。为了评估我们的居民代理是否能够生成可靠的行为和反馈，并为规划改进做出贡献，我们研究了在框架循环过程中，$\mathbf{R}_{19}$的参与情况（图[2](https://arxiv.org/html/2412.20505v1#Sx4.F2 "图2 ‣ 实验 ‣ 规划、生活与评估：基于大语言模型的循环城市规划多代理框架")）。简而言之，老年园丁期望在靠近家附近有更多的开放空间。他通过社交媒体分享了自己的愿望，并得到了$\mathbf{R}_{16}$的支持。在随后的访谈和讨论中，他坚持自己的这些愿望，最终$a_{12}$被批准改为开放空间。

## 结论与未来工作

本文提出了一种基于大语言模型（LLM）的城市规划框架，通过规划、生活和评估的循环迭代实现。北京回龙观的实验展示了我们框架在循环促进居民福祉方面的优势。此外，本文还通过案例研究探讨了居民代理的可信行为和迭代反馈。未来的工作将致力于提高规划与生活的逼真度和可扩展性，并丰富评估评判的各个方面。此外，我们将把我们的系统应用于更大的城市区域和更多的规划任务（*例如*，道路、基础设施等），并通过更全面的生活质量评估指标来评估更多的居民代理。

## 参考文献

+   Arnstein（1969）Arnstein, S. R. 1969. 公民参与阶梯。*美国规划师学会期刊*，35(4): 216–224。

+   Chigbu等人（2016）Chigbu, U. E.; Haub, O.; Mabikke, S.; Antonio, D.; 和 Espinoza, J. 2016. 对土地使用规划的 tenure 响应：国家级实施指南。*联合国人居署：肯尼亚内罗毕*。

+   Gao等人（2024）Gao, C.; Lan, X.; Li, N.; Yuan, Y.; Ding, J.; Zhou, Z.; Xu, F.; 和 Li, Y. 2024. 大语言模型驱动的基于代理的建模与仿真：一项调查与展望。*人文与社会科学通讯*，11(1): 1–24。

+   González-Méndez等人（2021）González-Méndez, M.; Olaya, C.; Fasolino, I.; Grimaldi, M.; 和 Obregón, N. 2021. 基于人类需求的城市发展规划的代理建模。概念基础与模型构建。*土地利用政策*，101: 105110。

+   Hosseinali, Alesheikh和Nourian（2013）Hosseinali, F.; Alesheikh, A. A.; 和 Nourian, F. 2013. 城市土地使用发展的代理建模，案例研究：模拟卡兹文市的未来情景。*城市*，31: 105–113。

+   Lane（2005）Lane, M. B. 2005. 规划中的公众参与：一段知识史。*澳大利亚地理学家*，36(3): 283–299。

+   Li等人（2020）Li, X.; Zhang, F.; Hui, E. C.-m.; 和 Lang, W. 2020. 协作工作坊与社区参与：一种中国城市再生的新方法。*城市*，102: 102743。

+   Oliveira和Pinho（2010）Oliveira, V.; 和 Pinho, P. 2010. 城市规划中的评估：进展与前景。*规划文献期刊*，24(4): 343–361。

+   Park等人（2023）Park, J. S.; O’Brien, J.; Cai, C. J.; Morris, M. R.; Liang, P.; 和Bernstein, M. S. 2023. 生成代理：人类行为的互动模拟。载于*第36届ACM用户界面软件与技术年会论文集*，1–22。

+   Park等人（2022）Park, J. S.; Popowski, L.; Cai, C.; Morris, M. R.; Liang, P.; 和Bernstein, M. S. 2022. 社会模拟：为社会计算系统创建人口原型。载于*第35届ACM用户界面软件与技术年会论文集*，1–18。

+   Qian等人（2023）Qian, K.; Mao, L.; Liang, X.; Ding, Y.; Gao, J.; Wei, X.; Guo, Z.; 和Li, J. 2023. AI代理作为城市规划者：通过基于共识的多智能体强化学习引导城市规划中的利益相关者动态。*arXiv预印本 arXiv:2310.16772*。

+   Ramezani和Nooraie（2023）Ramezani, S.; 和Nooraie, H. 2023. 参与性土地使用规划与城市权利理论的比较研究。*GeoJournal*，88(5)：5173–5203。

+   Santos和Martins（2007）Santos, L. D.; 和Martins, I. 2007. 监测城市生活质量：波尔图经验。*社会指标研究*，80：411–425。

+   Taylor（1998）Taylor, N. 1998. 自1945年以来的城市规划理论。

+   Wang等人（2023）Wang, D.; Fu, Y.; Liu, K.; Chen, F.; Wang, P.; 和Lu, C.-T. 2023. 通过对抗学习进行的自动化城市规划：量化、生成与评估。*ACM空间算法与系统交易*，9(1)：1–24。

+   Wang等人（2024）Wang, J.; Jiang, R.; Yang, C.; Wu, Z.; Onizuka, M.; Shibasaki, R.; Koshizuka, N.; 和Xiao, C. 2024. 大型语言模型作为城市居民：一个用于个人出行生成的LLM代理框架。*arXiv预印本 arXiv:2402.14744*。

+   Yan等人（2024）Yan, Y.; Zeng, Q.; Zheng, Z.; Yuan, J.; Feng, J.; Zhang, J.; Xu, F.; 和Li, Y. 2024. OpenCity：一个可扩展的平台，用于通过大量LLM代理模拟城市活动。*arXiv预印本 arXiv:2410.21286*。

+   Zheng等人（2023）Zheng, Y.; Lin, Y.; Zhao, L.; Wu, T.; Jin, D.; 和Li, Y. 2023. 通过深度强化学习进行城市社区的空间规划。*自然计算科学*，3(9)：748–762。

+   Zhou等人（2024）Zhou, Z.; Lin, Y.; Jin, D.; 和Li, Y. 2024. 大型语言模型在参与式城市规划中的应用。*arXiv预印本 arXiv:2402.17161*。
